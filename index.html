<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank</title>
</head>
<body>
    <center>
    <div>
        <h3> Bank </h3>
        <input id="amount" type="text">
        <p id="balance"></p>
        <button id="deposit">Deposit</button>
        <button id="withdraw">Withdraw</button>
        <p id="transaction">Blockchain Transactions : <br></p>
    </div>
    </center>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.3.4/web3.min.js" integrity="sha512-TTGImODeszogiro9DUvleC9NJVnxO6M0+69nbM3YE9SYcVe4wZp2XYpELtcikuFZO9vjXNPyeoHAhS5DHzX1ZQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous"></script>
    
    <script>

        var contract;
        
        $(document).ready(function(){
            
            web3 = new Web3(Web3.givenProvider);

            var address = '0x348B46aA33C15e7F333faB61cD92d9Ea39CE87bD'
           
            var abi = [
                {
                    "inputs": [
                        {
                            "internalType": "int256",
                            "name": "amount",
                            "type": "int256"
                        }
                    ],
                    "name": "deposit",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "int256",
                            "name": "amount",
                            "type": "int256"
                        }
                    ],
                    "name": "withdraw",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "getBalance",
                    "outputs": [
                        {
                            "internalType": "int256",
                            "name": "",
                            "type": "int256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ]

            contract = new web3.eth.Contract(abi, address);

            contract.methods.getBalance().call().then(function(bal)
            {
                console.log("balance checking .. ")
                    $('#balance').html(bal)
                    console.log('getting accounts information .. ')
                    
                }).catch(function(){
                    console.log("unable to check the balance")
                })

            })

        $("#deposit").click(function(){
            var amt = 0;
            console.log('amt', $("#amount").val())

            amt = parseInt($("#amount").val())
            web3.eth.getAccounts().then(console.log);
            
            web3.eth.getAccounts().then(function(accounts){
                var acc = accounts[0];
                return contract.methods.deposit(amt).send({
                        from: acc,
                })
            })
            .then(function(tx){
                console.log(tx)
                $("#transaction").append('<br/>deposit : '+JSON.stringify(tx,null,2)+"<br/><br/>")
                var current = parseInt($("#balance").html())
                $("#balance").html(current+amt)
            })
            .catch(function(tx){
                console.log('error', tx)
            })

        })

        $("#withdraw").click(function(){
            var amt = 0;
            console.log('amt', $("#amount").val())

            amt = parseInt($("#amount").val())
            web3.eth.getAccounts().then(console.log);
            
            web3.eth.getAccounts().then(function(accounts){
                var acc = accounts[0];
                return contract.methods.withdraw(amt).send({
                        from: acc,
                })
            })
            .then(function(tx){
                console.log(tx)
                $("#transaction").append('<br/>withdraw : '+JSON.stringify(tx,null,2)+"<br/><br/>")
                var current = parseInt($("#balance").html())
                $("#balance").html(current+amt)

            })
            .catch(function(tx){
                console.log('error', tx)
            })

        })


    </script>
</body>
</html>